<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Kalkulator MBG</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f7ff;
  margin: 0;
  padding: 16px;
}

h1 {
  text-align: center;
  color: #2563eb;
}

.card {
  background: #fff;
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 16px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
}

input {
  width: 100%;
  padding: 12px;
  margin-bottom: 12px;
  border-radius: 8px;
  border: 1px solid #ccc;
}

button {
  width: 100%;
  padding: 12px;
  border: none;
  border-radius: 8px;
  background: #2563eb;
  color: #fff;
  font-size: 16px;
  cursor: pointer;
}

button.hapus {
  background: #ef4444;
  margin-top: 8px;
}

.data-item {
  border-bottom: 1px solid #eee;
  padding-bottom: 12px;
  margin-bottom: 12px;
}

.total {
  background: #eff6ff;
}

.footer {
  text-align: center;
  margin-top: 24px;
  font-size: 14px;
  color: #777;
}
</style>
</head>

<body>

<h1>Kalkulator MBG</h1>

<!-- INPUT -->
<div class="card">
  <input id="nama" placeholder="Nama Sekolah">
  <input id="besar" type="number" placeholder="Porsi Besar">
  <input id="kecil" type="number" placeholder="Porsi Kecil">
  <button onclick="tambahData()">Tambah Data</button>
</div>

<!-- DAFTAR DATA -->
<div class="card">
  <h3>Data Sekolah</h3>
  <div id="listData"></div>
</div>

<!-- TOTAL -->
<div class="card total">
  <h3>Total Keseluruhan</h3>
  <div id="total"></div>
</div>

<!-- EXPORT -->
<div class="card">
  <button onclick="exportHTML()">Export HTML</button>
</div>

<div class="footer">
  Developed by dimsz
</div>

<script>
const ISI_PER_IKAT = 5;
let dataMBG = JSON.parse(localStorage.getItem("dataMBG")) || [];

function simpan() {
  localStorage.setItem("dataMBG", JSON.stringify(dataMBG));
}

function tambahData() {
  const nama = document.getElementById("nama").value.trim();
  const besar = Number(document.getElementById("besar").value);
  const kecil = Number(document.getElementById("kecil").value);

  if (!nama) return alert("Nama sekolah wajib diisi");

  dataMBG.push({ nama, besar, kecil });
  simpan();
  render();

  document.getElementById("nama").value = "";
  document.getElementById("besar").value = "";
  document.getElementById("kecil").value = "";
}

function hapusData(index) {
  dataMBG.splice(index, 1);
  simpan();
  render();
}

function render() {
  const list = document.getElementById("listData");
  const totalDiv = document.getElementById("total");

  list.innerHTML = "";
  let totalB = 0, totalK = 0;

  dataMBG.forEach((d, i) => {
    const ib = Math.floor(d.besar / ISI_PER_IKAT);
    const ob = d.besar % ISI_PER_IKAT;
    const ik = Math.floor(d.kecil / ISI_PER_IKAT);
    const ok = d.kecil % ISI_PER_IKAT;

    totalB += d.besar;
    totalK += d.kecil;

    list.innerHTML += `
      <div class="data-item">
        <b>${d.nama}</b><br>
        Porsi Besar: ${d.besar}<br>
        Ikat: ${ib}, Ompreng: ${ob}<br><br>
        Porsi Kecil: ${d.kecil}<br>
        Ikat: ${ik}, Ompreng: ${ok}
        <button class="hapus" onclick="hapusData(${i})">Hapus</button>
      </div>
    `;
  });

  totalDiv.innerHTML = `
    <b>Total Porsi Besar:</b> ${totalB}<br>
    <b>Total Porsi Kecil:</b> ${totalK}<br><br>
    <b>Total Ikat Besar:</b> ${Math.floor(totalB / ISI_PER_IKAT)}<br>
    <b>Total Ompreng Besar:</b> ${totalB % ISI_PER_IKAT}<br><br>
    <b>Total Ikat Kecil:</b> ${Math.floor(totalK / ISI_PER_IKAT)}<br>
    <b>Total Ompreng Kecil:</b> ${totalK % ISI_PER_IKAT}
  `;
}

function exportHTML() {
  let isi = document.getElementById("listData").innerHTML;
  let total = document.getElementById("total").innerHTML;

  const html = `
<!DOCTYPE html>
<html>
<head><meta charset="UTF-8"><title>Laporan MBG</title></head>
<body>
<h2>Laporan MBG</h2>
${isi}
<hr>
${total}
</body>
</html>`;

  const blob = new Blob([html], { type: "text/html" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "laporan_mbg.html";
  a.click();
}

render();
</script>

</body>
</html>